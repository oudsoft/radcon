<form id="trigger-form" method="post">
  <input type="hidden" id="dcmname"/>
  <input type="submit" value=" OK ">
</form>
<script src="../lib/jquery.js"></script>
<script>
  function urlQueryToObject(url) {
  	let result = url.split(/[?&]/).slice(1).map(function(paramPair) {
  				return paramPair.split(/=(.+)?/).slice(0, 2);
  		}).reduce(function (obj, pairArray) {
  				obj[pairArray[0]] = pairArray[1];
  				return obj;
  		}, {});
  	return result;
  }
  /*
  function doSetCookieForOrthanc(Username, Password) {
    var myDate = new Date();
    myDate.setMonth(myDate.getMonth() + 12);
    document.cookie = 'Username' + "=" + Username + ";expires=" + myDate + ";domain=localhost:8042;path=/";
  }
  */
  let urlParams = urlQueryToObject(window.location.search);
  let dcmnameParam = urlParams.dcmname;
  console.log(dcmnameParam);
  let userParam = urlParams.user;
  console.log(userParam);
  //doSetCookieForOrthanc(userParam, 'demo');
  let data = "doLocalStore('" + dcmnameParam + "')";
  let dcmnameForm = document.getElementById('dcmname');
  dcmnameForm.setAttribute("value", data);
  let triggerForm = document.getElementById('trigger-form');
  let triggerUrl = 'http://localhost:8042/tools/execute-script' + '?user=' + userParam;
  //triggerForm.append(new Blob([data], {type:"application/octet-stream"}));
  triggerForm.append(data);
  triggerForm.setAttribute("action", triggerUrl);
  /*
  setTimeout(() => {
    triggerForm.submit();
  }, 2500);
  */
  /*
  $.support.cors = true;
  let formData = new Blob([data], {type:"application/octet-stream"});
  $.ajax({
    url: triggerUrl,
    crossDomain: true,
    cors: true,
    type: "POST",
    cache: false,
    contentType: false,
    processData: false,
    headers: {
      'Access-Control-Allow-Origin': '*',
    },
    data: formData}).done(function(e){
      console.log(e);
    })
    */
</script>
